#include "Texture.h"
#include "Debugging.h"
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////

Texture::Texture()
	:m_pTexture(nullptr)
{

}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////

Texture::~Texture()
{

}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////

bool Texture::LoadTexture(ID3D11Device* pDevice, WCHAR* filename)
{
	m_pImage = new ScratchImage;
	TexMetadata texMeta;
	HRESULT hr = LoadFromTGAFile(filename, &texMeta, *m_pImage);
	if (FAILED(hr))
	{
		VS_LOG_VERBOSE("Failed to load tex from file");
		return false;
	}

	const Image* pImage = m_pImage->GetImage(0, 0, 0);
	hr = CreateShaderResourceView(pDevice, pImage, 1, texMeta, &m_pTexture);
	if (FAILED(hr))
	{
		VS_LOG_VERBOSE("Texture failed to load");
		return false;
	}
	
	
	return true;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void Texture::Shutdown()
{
	if (m_pTexture)
	{
		m_pTexture->Release();
		m_pTexture = nullptr;
	}
	if (m_pImage)
	{
		m_pImage->Release();
		m_pImage = nullptr;
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ID3D11ShaderResourceView* Texture::GetTexture()
{
	return m_pTexture;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
